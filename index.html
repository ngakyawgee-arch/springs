<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <title>LFM - Weekly Manager Pro (Full Fixed)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root { 
            --primary: #27ae60; 
            --danger: #e74c3c;
            --glass-dark: rgba(20, 20, 20, 0.95);
            --text: #ffffff;
        }
        body { 
            background: #0f172a;
            color: var(--text); 
            font-family: 'Pyidaungsu', sans-serif; 
            margin: 0; 
            padding-bottom: 90px;
        }
        .toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); padding: 14px 28px; border-radius: 12px; color: white; font-weight: bold; box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 9999; display: none; min-width: 250px; text-align: center; }
        .card { background: var(--glass-dark); padding: 18px; border-radius: 16px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.08); }
        .hide { display: none !important; }
        .page { padding: 15px; max-width: 550px; margin: auto; }
        input, select, textarea { width: 100%; padding: 14px; margin: 8px 0; border-radius: 10px; border: 1px solid #334155; background: #1e293b; color: white; font-size: 16px; box-sizing: border-box; }
        .btn { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.2s active; font-size: 16px; }
        .btn-save { background: var(--primary); color: white; }
        .btn-expense { background: #ea580c; color: white; }
        
        /* Nav */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #020617; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #1e293b; z-index: 100; }
        .nav-item { text-align: center; font-size: 11px; color: #64748b; cursor: pointer; transition: 0.3s; }
        .nav-item.active { color: var(--primary); font-weight: bold; transform: scale(1.1); }

        /* Stats */
        .balance-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px; }
        .bal-card { background: #1e293b; padding: 15px; border-radius: 16px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }

        /* --- Export Template Design --- */
        #exportArea { 
            position: fixed; left: -9999px; top: 0; width: 550px; 
            background: #ffffff; color: #1e293b; padding: 0;
        }
        .exp-header { background: #f8fafc; padding: 30px; text-align: center; border-bottom: 3px solid #27ae60; }
        .exp-logo { width: 80px; height: 80px; border-radius: 50%; border: 2px solid #27ae60; margin-bottom: 10px; }
        .exp-body { padding: 30px; background: white; }
        .exp-row { display: flex; justify-content: space-between; border-bottom: 1px dashed #e2e8f0; padding: 15px 5px; }
        .exp-label { color: #64748b; font-weight: 500; }
        .exp-value { color: #0f172a; font-weight: 700; font-size: 17px; }
        .exp-amount-wrap { margin-top: 30px; background: #f0fdf4; padding: 25px; border-radius: 15px; text-align: center; border: 2px solid #dcfce7; }
        .exp-note-box { margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 10px; border-left: 4px solid #cbd5e1; font-style: italic; color: #475569; }
        .exp-footer { padding: 20px; text-align: center; font-size: 11px; color: #94a3b8; background: #f8fafc; }
    </style>
</head>
<body>

    <div id="toast" class="toast"></div>

    <div id="loginPage" class="page">
        <div style="text-align: center; margin-top: 80px; margin-bottom: 40px;">
            <div style="font-size: 60px; margin-bottom: 10px;">ğŸ›¡ï¸</div>
            <h1 style="margin: 0; letter-spacing: 1px;">LFM PRO</h1>
            <p style="color: #64748b;">Financial Management System</p>
        </div>
        <div class="card">
            <input type="email" id="email" placeholder="á€¡á€®á€¸á€™á€±á€¸á€œá€º">
            <input type="password" id="password" placeholder="á€œá€»á€¾á€­á€¯á€·á€á€¾á€€á€ºá€”á€¶á€•á€«á€á€º">
            <button class="btn btn-save" id="loginBtn" onclick="login()">á€¡á€€á€±á€¬á€„á€·á€ºá€á€„á€ºá€™á€Šá€º</button>
            <p id="loginError" style="color: var(--danger); font-size: 12px; margin-top: 10px; text-align: center;"></p>
        </div>
    </div>

    <div id="mainApp" class="hide">
        <div class="page">
            <div class="balance-grid">
                <div class="bal-card">
                    <small style="color: #94a3b8;">á€¡á€œá€¾á€°á€„á€½á€±á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸</small>
                    <div id="globalIncome" style="color:#22c55e; font-weight:800; font-size: 1.1em; margin-top:4px;">0</div>
                </div>
                <div class="bal-card">
                    <small style="color: #94a3b8;">á€¡á€á€¯á€¶á€¸á€…á€›á€­á€á€º</small>
                    <div id="globalExpense" style="color:#ef4444; font-weight:800; font-size: 1.1em; margin-top:4px;">0</div>
                </div>
            </div>

            <div class="card" style="background: rgba(39, 174, 96, 0.1); border: 1px solid var(--primary);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <small style="color: var(--primary);">á€á€á€ºá€™á€¾á€á€ºá€˜á€á€ºá€‚á€»á€€á€º (Budget)</small>
                    <button onclick="setBudget()" style="background: none; border: 1px solid var(--primary); color: white; border-radius: 5px; font-size: 10px; cursor: pointer;">á€•á€¼á€„á€ºá€™á€Šá€º</button>
                </div>
                <div id="budgetValue" style="font-size: 22px; font-weight: bold; margin: 5px 0;">0 á€˜á€á€º</div>
                <div style="width: 100%; background: #334155; height: 8px; border-radius: 4px;">
                    <div id="budgetBar" style="height: 100%; width: 0%; background: var(--primary); border-radius: 4px; transition: 0.5s;"></div>
                </div>
            </div>

            <div class="card" style="text-align:center; background: linear-gradient(to right, #1e293b, #0f172a);">
                <small style="color: #94a3b8;">á€œá€€á€ºá€€á€»á€”á€ºá€„á€½á€±</small>
                <div id="netBalance" style="font-size:26px; font-weight:900; margin-top:5px;">0 á€˜á€á€º</div>
            </div>
        </div>

        <div id="incomeTab" class="page">
            <h3>ğŸ’° á€¡á€œá€¾á€°á€›á€¾á€„á€ºá€…á€¬á€›á€„á€ºá€¸á€á€½á€„á€ºá€¸á€›á€”á€º</h3>
            <div class="card">
                <input type="text" id="donorName" placeholder="á€¡á€œá€¾á€°á€›á€¾á€„á€ºá€¡á€™á€Šá€º">
                <input type="number" id="incomeAmount" placeholder="á€•á€™á€¬á€ (á€˜á€á€º)">
                <select id="incomeWeek"></select>
                <input type="date" id="incomeDate">
                <button class="btn btn-save" onclick="saveIncome()">á€’á€±á€á€¬á€á€­á€™á€ºá€¸á€™á€Šá€º</button>
            </div>
            <div id="incomeHistoryList"></div>
        </div>

        <div id="expenseTab" class="page hide">
            <h3>ğŸšš á€‘á€±á€¬á€€á€ºá€•á€­á€¯á€·á€…á€›á€­á€á€ºá€™á€¾á€á€ºá€á€™á€ºá€¸</h3>
            <div class="card">
                <input type="text" id="expOrg" placeholder="á€œá€€á€ºá€á€¶á€á€Šá€·á€ºá€¡á€–á€½á€²á€·á€¡á€™á€Šá€º">
                <input type="text" id="expActivity" placeholder="á€œá€¾á€¯á€•á€ºá€›á€¾á€¬á€¸á€™á€¾á€¯á€¡á€™á€»á€­á€¯á€¸á€¡á€…á€¬á€¸">
                <input type="text" id="expRegion" placeholder="á€’á€±á€/á€”á€±á€›á€¬">
                <input type="number" id="expAmount" placeholder="á€œá€¾á€°á€’á€«á€”á€ºá€¸á€„á€½á€± (á€˜á€á€º)">
                <input type="date" id="expDate">
                <textarea id="expNote" rows="2" placeholder="á€¡á€á€¼á€¬á€¸á€™á€¾á€á€ºá€á€»á€€á€ºá€™á€»á€¬á€¸..."></textarea>
                <button class="btn btn-expense" onclick="saveExpense()">á€™á€¾á€á€ºá€á€™á€ºá€¸á€á€„á€ºá€™á€Šá€º</button>
            </div>
        </div>

        <div id="historyTab" class="page hide">
            <div style="display:flex; justify-content: space-between; align-items: center;">
                <h3>ğŸ“œ á€™á€¾á€á€ºá€á€™á€ºá€¸á€Ÿá€±á€¬á€„á€ºá€¸á€™á€»á€¬á€¸</h3>
                <span id="historyCount" style="background:#334155; padding:4px 10px; border-radius:20px; font-size:12px;">0</span>
            </div>
            <input type="text" id="historySearch" placeholder="á€¡á€–á€½á€²á€·á€¡á€™á€Šá€ºá€–á€¼á€„á€·á€º á€›á€¾á€¬á€–á€½á€±á€›á€”á€º..." onkeyup="filterHistory()">
            <div id="expenseHistoryList"></div>
        </div>
    </div>

    <div id="exportArea">
        <div class="exp-header">
            <img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/7QBEUGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAACgcAigAIkZCTUQzMDAwMDI3NDAyMDAwMGI1Y2UwMDAwNGUxNzAxMDAA/9sAQwADAgICAgIDAgICAwMDAwQGBAQEBAQIBgYFBgkICgoJCAkJCgwPDAoLDgsJCQ0RDQ4PEBAREAoMEhMSEBMPEBAQ/9sAQwEDAwMEAwQIBAQIEAsJCxAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQ/8AAEQgAwADAAwEiAAIRAQMRAf/EAB4AAAICAwEBAQEAAAAAAAAAAAAHBggBBQkEAwIK/8QAPhAAAQQBAwIEBAQDBwMEAwAAAQIDBAUGAAcREiEIEzFBFCIyURUjYYEWQnEkM1JykaGxCUNiFzRTZGOCwf/EABwBAQACAwEBAQAAAAAAAAAAAAABBQIEBgcDCP/EABoBAQEBAQEBAQAAAAAAAAAAAAABAgMEBQb/2gAMè§†è§‰æ•ˆæœ/4BAwIEBggJCgsJCAkJCgwPDAoLDgsJCQ0RDQ4PEBAREAoMEhMSEBMPEBAQ/9sAQwEDAwMEAwQIBAQIEAsJCxAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQ/8AAEQgAwADAAwEiAAIRAQMRAf/EAB4AAAICAwEBAQEAAAAAAAAAAAAHBggBBQkEAwIK/8QAPhAAAQQBAwIEBAQDBwMEAwAAAQIDBAUGAAcREiEIEzFBFCIyURUjYYEWQnEkM1JykaGxCUNiFzRTZGOCwf/EABwBAQACAwEBAQAAAAAAAAAAAAABBQIEBgcDCP/EADURAAEDAwMSOv6a+789vl6f9M9P8f9UTh0FQHbn9h66Ubm32/j3eb4iosVv3VAwuI0r9i+86P8AbWmi4FhOVX9hjWU+JnLMutapouWtKxlcatVHQPUvRqtLDiE+3CzptaO6Ji5xu9trtwWmcyzCvr5kjj4ev6y9Okk+gZithTzp/RCDqGuZRvdul/ZsGxpzbmgd+q/ySKl22dR37xazkpZP7vLWoEe7CtRPZ3dPwsQncIVspj0FuFuPnsamLdQq0Mq+Ohs+eqNNdd4kB5xtK1thzkrCOfRSSUdl293iC3Nyi92ktqClk1WRsXuISKKDLXXWMa7rXCpw109Xyl9yE9EsGW5HShxKHUBxHQSpIHARPrbS52tTc5zt/sDefxJn8aucdu8ysQq0ZTZ9JTGZnzkkeYsKJUIzPCW0IWAlvsDTB7Et6d/94WUZ1tjFczlFS7iWYOMrdRUSJUI/FMR7Jtsl2AiQz1liW1yguIhyGFhSHWU2q8OmC5pdRdst7msVG3GRQ6Z7Ed+McmVBgN2kWMpwMyGmEAJbcRIT5rSgCnypLyOSOk6YE/caXnd9Y1Ph3p6qbYvlEG6zp+MF1UDyioBpK09KrKQ31L6WW1eU2VHzHEHlCogvMpwtBEx3H9hbP8B2+GQZ/u1lkFtiKrJr16xkxa5pR6XJUlfeLXsrWskpSFOrPSkOOns1Nr9tY+31fMlWFo5e5PevCbkF7IbCHbCSE8JASCQ0w2n5GmQeltA47qKlK+m2+19DtvDmGHJmWtzcOplXN5ZOB2faSAOA48sAABI+VDaAlttPyoSkamOhIGGqUKIOjgDRo1iiNGjRoiNGjRoiNGjRoiNGjRoiNAHGjRoi1eTYvjmZUkrG8so4NvVTUdEiHNYS8y6nnkdSVAg8Hgg+oIBHB0tEbfbrbY8ObT5UjJaFv6cWyyY6pbCB/JDtOFvIAHACJCX0+gC2xpvH+ms+2sg4twir/uPuFtfuThljtTvvCyDbJy4DSAu6CYrTclpxDzL0WyQXIa1oebbWgFzklI6kcEjUPzXwhZBum5AyXJt5nsyl2dlTMT7NTLdaljG4cozVxoIhDpD70puMtb3UCfLT0lAQlOrVSosSdHdhTYzT7DySh1p1AUhaT6hST2I/rpayvDXtMmS7YYrTTs$" class="exp-logo">
            <h2 style="margin: 5px 0; color: #27ae60;">á€–á€­á€¯á€¸á€…á€±á€¬á€„á€·á€ºá€á€±á€¬á€„á€ºá€™á€®á€¸á€¡á€­á€™á€º</h2>
            <p id="outTypeTitle" style="margin: 0; font-size: 14px; font-weight: bold; color: #475569;">á€™á€¾á€á€ºá€á€™á€ºá€¸</p>
        </div>
        <div class="exp-body">
            <div id="outRows"></div>
            <div class="exp-amount-wrap">
                <div style="color: #10b981; font-weight: bold; font-size: 14px;" id="outAmtLabel">á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸</div>
                <div style="font-size: 34px; font-weight: 900; color: #1e293b; margin-top: 5px;"><span id="outAmt"></span> <small style="font-size: 15px;">THB</small></div>
            </div>
            <div id="outNoteArea" class="exp-note-box hide">
                <small>á€™á€¾á€á€ºá€á€»á€€á€ºá‹</small><br>
                <span id="outNote"></span>
            </div>
        </div>
        <div class="exp-footer">
            á€¤á€™á€¾á€á€ºá€á€™á€ºá€¸á€€á€­á€¯ LFM Weekly Manager á€™á€¾ á€‘á€¯á€á€ºá€•á€±á€¸á€•á€«á€á€Šá€ºá‹
        </div>
    </div>

    <nav id="bottomNav" class="bottom-nav hide">
        <div class="nav-item active" onclick="switchTab('incomeTab', this)">ğŸ’°<br>á€¡á€œá€¾á€°á€›á€¾á€„á€º</div>
        <div class="nav-item" onclick="switchTab('expenseTab', this)">ğŸšš<br>á€‘á€±á€¬á€€á€ºá€•á€­á€¯á€·</div>
        <div class="nav-item" onclick="historyClick(this)">ğŸ“œ<br>á€™á€¾á€á€ºá€á€™á€ºá€¸</div>
        <div class="nav-item" onclick="logout()">ğŸšª<br>á€‘á€½á€€á€ºá€›á€”á€º</div>
    </nav>

    <script>
        // á€¡á€á€…á€ºá€›á€›á€¾á€­á€‘á€¬á€¸á€á€±á€¬ Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyBojMFTkLXmaFGqwq9tLKpXp-wXKqkN_no",
            authDomain: "lamp-88a25.firebaseapp.com",
            databaseURL: "https://lamp-88a25-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "lamp-88a25",
            storageBucket: "lamp-88a25.firebasestorage.app",
            messagingSenderId: "151980650338",
            appId: "1:151980650338:web:0e4e02c09d0ba58a16c63b"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        let totalInc = 0;
        let totalExp = 0;
        let currentBudget = 0;

        // Auto Weeks
        const ws = document.getElementById('incomeWeek');
        for (let i = 1; i <= 100; i++) {
            let o = document.createElement('option');
            o.value = `Week-${i}`; o.textContent = `á€¡á€•á€á€ºá€…á€‰á€º ${i}`;
            ws.appendChild(o);
        }

        function showToast(m, type="success") {
            const t = document.getElementById('toast');
            t.textContent = m;
            t.style.background = type === "success" ? "#10b981" : "#ef4444";
            t.style.display = "block";
            setTimeout(() => t.style.display = "none", 2500);
        }

        // Budget Logic
        function setBudget() {
            const b = prompt("á€˜á€á€ºá€‚á€»á€€á€ºá€•á€™á€¬á€ á€á€á€ºá€™á€¾á€á€ºá€•á€« (á€˜á€á€º):", currentBudget);
            if (b !== null) db.ref('settings/budget').set(parseFloat(b));
        }

        function updateBudgetUI() {
            document.getElementById('budgetValue').textContent = currentBudget.toLocaleString() + " á€˜á€á€º";
            const percent = currentBudget > 0 ? Math.min((totalExp / currentBudget) * 100, 100) : 0;
            document.getElementById('budgetBar').style.width = percent + "%";
            document.getElementById('budgetBar').style.background = percent > 90 ? "#e74c3c" : "#27ae60";
        }

        function syncData() {
            // Budget Listener
            db.ref('settings/budget').on('value', s => {
                currentBudget = s.val() || 0;
                updateBudgetUI();
            });

            // Income Listener
            db.ref('weekly_donations').on('value', s => {
                totalInc = 0;
                const list = document.getElementById('incomeHistoryList');
                list.innerHTML = '<h4 style="margin-top:20px;">á€™á€€á€¼á€¬á€á€±á€¸á€™á€®á€€ á€¡á€œá€¾á€°á€›á€¾á€„á€ºá€™á€»á€¬á€¸</h4>';
                let arr = [];
                s.forEach(w => { 
                    w.forEach(c => { 
                        const v = c.val();
                        totalInc += parseFloat(v.amount || 0); 
                        arr.push({id: c.key, week: w.key, ...v});
                    }); 
                });
                arr.reverse().slice(0, 10).forEach(item => {
                    list.insertAdjacentHTML('beforeend', `
                        <div class="card" style="font-size:13px; padding:12px;">
                            <div style="display:flex; justify-content:space-between;">
                                <b>${item.donorName}</b>
                                <span>${parseFloat(item.amount).toLocaleString()} á€˜á€á€º</span>
                            </div>
                            <div style="display:flex; justify-content:space-between; margin-top:5px; color:#64748b;">
                                <small>${item.week} | ${item.date}</small>
                                <button onclick="exportDonorPNG('${item.week}','${item.id}')" style="background:none; border:none; color:var(--primary); cursor:pointer;">ğŸ“· PNG</button>
                            </div>
                        </div>
                    `);
                });
                document.getElementById('globalIncome').textContent = totalInc.toLocaleString();
                updateNet();
            });

            // Expense Listener
            db.ref('expenses').on('value', s => {
                totalExp = 0;
                const list = document.getElementById('expenseHistoryList');
                list.innerHTML = '';
                let arr = [];
                s.forEach(c => {
                    const v = c.val();
                    arr.push({id: c.key, ...v});
                    totalExp += parseFloat(v.amount || 0);
                });
                arr.reverse().forEach(item => {
                    list.insertAdjacentHTML('beforeend', `
                        <div class="card" style="border-right: 4px solid #ea580c;">
                            <div style="display:flex; justify-content: space-between;">
                                <b style="color:#22c55e; font-size:1.1em;">${item.org}</b>
                                <span style="font-size:12px; color:#64748b;">${item.date}</span>
                            </div>
                            <div style="margin: 8px 0; font-size:14px; color:#cbd5e1;">${item.activity} - ${item.region}</div>
                            <div style="font-weight:bold; font-size:16px;">${parseFloat(item.amount).toLocaleString()} á€˜á€á€º</div>
                            <div style="display:flex; gap:8px; margin-top:12px;">
                                <button class="btn btn-save" style="flex:1; padding:8px; font-size:12px;" onclick="exportExpensePNG('${item.id}')">ğŸ“· á€•á€¯á€¶á€‘á€¯á€á€ºá€›á€”á€º</button>
                                <button class="btn" style="flex:1; padding:8px; font-size:12px; background:#334155; color:white;" onclick="delExp('${item.id}')">á€–á€»á€€á€ºá€™á€Šá€º</button>
                            </div>
                        </div>
                    `);
                });
                document.getElementById('globalExpense').textContent = totalExp.toLocaleString();
                document.getElementById('historyCount').textContent = arr.length;
                updateNet();
                updateBudgetUI();
            });
        }

        function updateNet() {
            const net = totalInc - totalExp;
            const nEl = document.getElementById('netBalance');
            nEl.textContent = net.toLocaleString() + " á€˜á€á€º";
            nEl.style.color = net >= 0 ? "#22c55e" : "#ef4444";
        }

        async function login() {
            const e = document.getElementById('email').value.trim();
            const p = document.getElementById('password').value;
            const errEl = document.getElementById('loginError');
            const btn = document.getElementById('loginBtn');

            if(!e || !p) { errEl.textContent = "á€¡á€®á€¸á€™á€±á€¸á€œá€ºá€”á€¾á€„á€·á€º á€…á€€á€¬á€¸á€á€¾á€€á€º á€–á€¼á€Šá€·á€ºá€•á€«á‹"; return; }
            errEl.textContent = "á€á€á€…á€±á€¬á€„á€·á€ºá€•á€«...";
            btn.disabled = true;

            try { await auth.signInWithEmailAndPassword(e, p); } 
            catch (err) {
                btn.disabled = false;
                if(err.code === 'auth/user-not-found') errEl.textContent = "á€¡á€€á€±á€¬á€„á€·á€ºá€™á€›á€¾á€­á€•á€«á‹";
                else if(err.code === 'auth/wrong-password') errEl.textContent = "á€…á€€á€¬á€¸á€á€¾á€€á€ºá€™á€¾á€¬á€¸á€”á€±á€á€Šá€ºá‹";
                else errEl.textContent = "á€á€„á€ºá€›á€±á€¬á€€á€ºáá€™á€›á€•á€«á‹ (Firebase Auth á€€á€­á€¯á€…á€…á€ºá€•á€«)";
            }
        }

        auth.onAuthStateChanged(u => {
            if (u) {
                document.getElementById('loginPage').classList.add('hide');
                document.getElementById('mainApp').classList.remove('hide');
                document.getElementById('bottomNav').classList.remove('hide');
                document.getElementById('incomeDate').valueAsDate = new Date();
                document.getElementById('expDate').valueAsDate = new Date();
                syncData();
            }
        });

        function switchTab(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.add('hide'));
            document.getElementById(id).classList.remove('hide');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        }

        function historyClick(el) { switchTab('historyTab', el); }

        function sav