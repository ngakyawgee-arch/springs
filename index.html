<!DOCTYPE html>
<html lang="my">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>á€–á€­á€¯á€¸á€…á€±á€¬á€„á€·á€ºá€á€±á€¬á€„á€ºá€™á€®á€¸á€¡á€­á€™á€º (LFM)</title>

<!-- ICON / PWA -->
<link rel="icon" href="https://i.ibb.co/1000011246/logo.jpg">
<meta name="theme-color" content="#000000">
<link rel="apple-touch-icon" href="https://i.ibb.co/1000011246/logo.jpg">
<link rel="manifest" href="data:application/json,{
 &quot;name&quot;:&quot;LFM&quot;,
 &quot;short_name&quot;:&quot;LFM&quot;,
 &quot;start_url&quot;:&quot;.&quot;,
 &quot;display&quot;:&quot;standalone&quot;,
 &quot;background_color&quot;:&quot;#000000&quot;,
 &quot;theme_color&quot;:&quot;#000000&quot;,
 &quot;icons&quot;:[{
  &quot;src&quot;:&quot;https://i.ibb.co/1000011246/logo.jpg&quot;,
  &quot;sizes&quot;:&quot;192x192&quot;,
  &quot;type&quot;:&quot;image/png&quot;
 }]
}">

<style>
body{margin:0;background:#0b0b0b;color:#eee;font-family:sans-serif}
.hidden{display:none}
h1,h2,h3{text-align:center}
.card{background:#151515;margin:12px;padding:16px;border-radius:16px}
input,button{width:100%;padding:12px;margin:6px 0;border-radius:10px;border:none}
button{background:#b91c1c;color:#fff;font-weight:bold}
.green{background:#1b8f4a}
.red{background:#7f1d1d}
.tabbar{display:flex;gap:6px;margin:10px}
.tabbar button{flex:1;background:#222}
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{border-bottom:1px solid #333;padding:6px}
td[contenteditable]{background:#111}
.action button{font-size:11px;padding:6px}
footer{text-align:center;font-size:12px;color:#777;margin:20px}
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- Tools -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<!-- SPLASH -->
<div id="splash" style="position:fixed;inset:0;background:#000;display:flex;align-items:center;justify-content:center;z-index:9999">
<img src="https://i.ibb.co/1000011246/logo.jpg" style="width:160px;border-radius:50%">
</div>

<h2>âœŠ á€–á€­á€¯á€¸á€…á€±á€¬á€„á€·á€ºá€á€±á€¬á€„á€ºá€™á€®á€¸á€¡á€­á€™á€º (LFM)</h2>
<p style="text-align:center;color:#aaa">á€á€±á€¬á€ºá€œá€¾á€”á€ºá€›á€±á€¸ á€¡á€œá€¾á€°á€…á€”á€…á€º</p>

<!-- MEMBER PIN -->
<div id="memberLogin" class="card">
<h3>ğŸ” Member Access</h3>
<input id="memberPin" type="password" placeholder="Member PIN">
<button onclick="memberLogin()">á€á€„á€ºá€™á€šá€º</button>
</div>

<!-- MEMBER VIEW -->
<div id="memberBox" class="card hidden">
<h3>âœŠ á€•á€¼á€Šá€ºá€á€°á€·á€‘á€±á€¬á€€á€ºá€•á€¶á€· á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸</h3>
<h1 id="memberTotal">0</h1>
<button onclick="exportPNG('memberBox')">PNG</button>
<button onclick="exportPDF('memberBox')">PDF</button>
</div>

<!-- ADMIN LOGIN -->
<div id="loginBox" class="card">
<h3>ğŸ” Admin Login</h3>
<input id="email" placeholder="Email">
<input id="password" type="password">
<button onclick="login()">Login</button>
</div>

<!-- APP -->
<div id="app" class="hidden">

<div class="tabbar">
<button onclick="showTab('donate')">á€¡á€œá€¾á€°á€‘á€Šá€·á€º</button>
<button onclick="showTab('list')">á€…á€¬á€›á€„á€ºá€¸</button>
<button onclick="showTab('report')">Report</button>
<button onclick="logout()" class="red">Logout</button>
</div>

<div id="donate" class="card">
<h3>âœŠ á€¡á€œá€¾á€°á€…á€¬á€›á€„á€ºá€¸á€á€½á€„á€ºá€¸</h3>
<input id="name" placeholder="á€¡á€œá€¾á€°á€›á€¾á€„á€ºá€¡á€™á€Šá€º">
<input id="country" placeholder="á€”á€±á€›á€•á€º">
<input id="amount" type="number" placeholder="á€¡á€œá€¾á€°á€„á€½á€±">
<button class="green" onclick="addData()">á€á€­á€™á€ºá€¸á€™á€šá€º</button>
</div>

<div id="list" class="card hidden">
<h3>ğŸ“‹ á€¡á€œá€¾á€°á€…á€¬á€›á€„á€ºá€¸</h3>
<table>
<thead>
<tr><th>á€¡á€™á€Šá€º</th><th>á€”á€±á€›á€•á€º</th><th>á€„á€½á€±</th><th>á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€á€»á€€á€º</th></tr>
</thead>
<tbody id="rows"></tbody>
</table>
<button onclick="exportPNG('list')">PNG</button>
<button onclick="exportPDF('list')">PDF</button>
</div>

<div id="report" class="card hidden">
<h3>ğŸ“Š á€œá€…á€‰á€º á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸</h3>
<h1 id="total">0</h1>
<canvas id="chart"></canvas>
<button onclick="monthlyPDF()">ğŸ“„ Monthly PDF</button>
</div>

</div>

<footer>âœŠ Revolution Powered by LFM</footer>

<script>
// SPLASH
setTimeout(()=>splash.remove(),1500);

// FIREBASE
firebase.initializeApp({
 apiKey:"AIzaSyBojMFTkLXmaFGqwq9tLKpXp-wXKqkN_no",
 authDomain:"lamp-88a25.firebaseapp.com",
 databaseURL:"https://lamp-88a25-default-rtdb.asia-southeast1.firebasedatabase.app",
 projectId:"lamp-88a25"
});
const auth=firebase.auth();
const db=firebase.database();

// MEMBER PIN
const MEMBER_PIN="1234";
function memberLogin(){
 if(memberPin.value===MEMBER_PIN){
  localStorage.setItem("member","1");
  memberLogin.classList.add("hidden");
  memberBox.classList.remove("hidden");
 }else alert("PIN á€™á€¾á€¬á€¸á€”á€±á€á€šá€º");
}
if(localStorage.getItem("member")==="1"){
 memberLogin.classList.add("hidden");
 memberBox.classList.remove("hidden");
}

// ADMIN
function login(){
 auth.signInWithEmailAndPassword(email.value,password.value)
 .then(()=>{
  loginBox.classList.add("hidden");
  app.classList.remove("hidden");
  showTab("donate");
  load();
 })
 .catch(e=>alert(e.message));
}
function logout(){auth.signOut();location.reload()}

function showTab(id){
 ["donate","list","report"].forEach(x=>document.getElementById(x).classList.add("hidden"));
 document.getElementById(id).classList.remove("hidden");
}

// CRUD
function addData(){
 if(!name.value||!amount.value) return alert("á€™á€•á€¼á€Šá€·á€ºá€…á€¯á€¶á€•á€«");
 db.ref("donations").push({
  name:name.value,
  country:country.value,
  amount:+amount.value
 });
 name.value=country.value=amount.value="";
}

let chart;
function load(){
 db.ref("donations").on("value",snap=>{
  rows.innerHTML="";
  let sum=0, labels=[], data=[];
  snap.forEach(s=>{
   const d=s.val(); sum+=d.amount;
   labels.push(d.name); data.push(d.amount);
   rows.innerHTML+=`
   <tr>
    <td contenteditable onblur="edit('${s.key}','name',this.innerText)">${d.name}</td>
    <td contenteditable onblur="edit('${s.key}','country',this.innerText)">${d.country}</td>
    <td contenteditable onblur="edit('${s.key}','amount',this.innerText)">${d.amount}</td>
    <td class="action"><button class="red" onclick="del('${s.key}')">Del</button></td>
   </tr>`;
  });
  total.innerText=sum;
  memberTotal.innerText=sum;

  if(chart) chart.destroy();
  chart=new Chart(document.getElementById("chart"),{
   type:"bar",
   data:{labels:labels,datasets:[{label:"á€¡á€œá€¾á€°á€„á€½á€±",data:data}]}
  });
 });
}
function edit(id,f,v){
 const o={}; o[f]=f=="amount"?Number(v):v;
 db.ref("donations/"+id).update(o);
}
function del(id){
 if(confirm("á€–á€»á€€á€ºá€™á€œá€¬á€¸")) db.ref("donations/"+id).remove();
}

// EXPORT
function exportPNG(id){
 html2canvas(document.getElementById(id)).then(c=>{
  let a=document.createElement("a");
  a.download=id+".png"; a.href=c.toDataURL(); a.click();
 });
}
function exportPDF(id){
 const {jsPDF}=window.jspdf;
 html2canvas(document.getElementById(id)).then(c=>{
  const pdf=new jsPDF();
  pdf.addImage(c.toDataURL(),"PNG",10,10,190,0);
  pdf.save(id+".pdf");
 });
}
function monthlyPDF(){ exportPDF("report"); }

// OFFLINE SW
if("serviceWorker"in navigator){
 const code=`self.addEventListener('fetch',e=>e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request))))`;
 navigator.serviceWorker.register(URL.createObjectURL(new Blob([code])));
}
</script>

</body>
</html>