<!DOCTYPE html>
<html lang="my">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ğŸ”¥ LAMP Donation System</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- html2canvas -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body{margin:0;font-family:sans-serif;background:#111;color:#eee}
.hidden{display:none}
.box{max-width:420px;margin:20px auto;padding:20px;border-radius:12px;background:#1c1c1c}
input,select,button{width:100%;padding:12px;margin:6px 0;border-radius:8px;border:none}
button{background:#1e8e3e;color:#fff;font-weight:bold}
table{width:100%;border-collapse:collapse;margin-top:10px}
td,th{border:1px solid #444;padding:6px;text-align:center}
.menu button{margin:4px 0;background:#333}
.logout{background:#b3261e}
h2{text-align:center}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox" class="box">
<h2>âœŠ á€á€±á€¬á€ºá€œá€¾á€”á€ºá€›á€±á€¸ á€¡á€œá€¾á€° á€…á€”á€…á€º</h2>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="doLogin()">á€á€„á€ºá€™á€Šá€º</button>
</div>

<!-- APP -->
<div id="appBox" class="hidden">

<div class="box menu">
<button onclick="showTab('donate')">ğŸ’° á€¡á€œá€¾á€°á€‘á€Šá€·á€º</button>
<button onclick="showTab('table')">ğŸ“‹ á€…á€¬á€›á€„á€ºá€¸</button>
<button onclick="showTab('report')">ğŸ“Š Monthly Report</button>
<button onclick="exportPNG()">ğŸ§¾ Receipt PNG</button>
<button class="logout" onclick="logout()">Logout</button>
</div>

<!-- DONATE -->
<div id="donate" class="box hidden">
<input id="name" placeholder="á€¡á€™á€Šá€º">
<input id="country" placeholder="á€”á€­á€¯á€„á€ºá€„á€¶">
<input id="amount" type="number" placeholder="á€„á€½á€±á€•á€™á€¬á€">
<input id="note" placeholder="á€™á€¾á€á€ºá€á€»á€€á€º">
<button onclick="addData()">á€á€­á€™á€ºá€¸á€™á€Šá€º</button>
</div>

<!-- TABLE -->
<div id="table" class="box hidden">
<table>
<thead><tr><th>á€¡á€™á€Šá€º</th><th>á€”á€­á€¯á€„á€ºá€„á€¶</th><th>Ks</th></tr></thead>
<tbody id="list"></tbody>
</table>
</div>

<!-- REPORT -->
<div id="report" class="box hidden">
<h2>á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸</h2>
<h1 id="total">0 Ks</h1>
</div>

<!-- RECEIPT -->
<div id="receipt" class="box hidden">
<h2>ğŸ§¾ LAMP Donation Receipt</h2>
<div id="receiptContent"></div>
</div>

</div>

<script>
/* Firebase Config */
firebase.initializeApp({
 apiKey: "AIzaSyBojMFTkLXmaFGqwq9tLKpXp-wXKqkN_no",
 authDomain: "lamp-88a25.firebaseapp.com",
 databaseURL: "https://lamp-88a25-default-rtdb.asia-southeast1.firebasedatabase.app",
 projectId: "lamp-88a25",
 storageBucket: "lamp-88a25.firebasestorage.app",
 messagingSenderId: "151980650338",
 appId: "1:151980650338:web:0e4e02c09d0ba58a16c63b"
});

const auth = firebase.auth();
const db = firebase.database();

/* Login */
function doLogin(){
 auth.signInWithEmailAndPassword(email.value,password.value)
 .then(()=>{
  loginBox.classList.add("hidden");
  appBox.classList.remove("hidden");
  load();
 })
 .catch(e=>alert(e.message));
}

/* Logout */
function logout(){
 auth.signOut().then(()=>location.reload());
}

/* Tabs */
function showTab(id){
 ["donate","table","report"].forEach(t=>document.getElementById(t).classList.add("hidden"));
 document.getElementById(id).classList.remove("hidden");
}

/* Add Data */
function addData(){
 const d={
  name:name.value,
  country:country.value,
  amount:+amount.value,
  time:Date.now()
 };
 db.ref("donations").push(d);
 name.value=country.value=amount.value=note.value="";
}

/* Load */
function load(){
 db.ref("donations").on("value",snap=>{
  let html="",sum=0,receipt="";
  snap.forEach(s=>{
   let d=s.val();
   sum+=d.amount;
   html+=`<tr><td>${d.name}</td><td>${d.country}</td><td>${d.amount}</td></tr>`;
   receipt+=`${d.name} - ${d.amount} Ks<br>`;
  });
  list.innerHTML=html;
  total.innerText=sum+" Ks";
  receiptContent.innerHTML=receipt;
 });
}

/* Export PNG */
function exportPNG(){
 showTab("receipt");
 html2canvas(receipt).then(c=>{
  let a=document.createElement("a");
  a.href=c.toDataURL();
  a.download="receipt.png";
  a.click();
 });
}
</script>

</body>
</html>