<!DOCTYPE html>
<html lang="my">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Revolution Fund Management</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- html2canvas -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body{margin:0;font-family:sans-serif;background:#0f172a;color:#e5e7eb}
.hidden{display:none}
.card{background:#020617;margin:12px;padding:14px;border-radius:14px;border:1px solid #334155}
input,textarea,select,button{
 width:100%;padding:10px;margin:6px 0;border-radius:8px;
 border:1px solid #475569;background:#020617;color:#e5e7eb
}
button{background:#dc2626;color:#fff;font-weight:bold;border:none}
button.alt{background:#2563eb}
button.dark{background:#020617;border:1px solid #475569}
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{border:1px solid #334155;padding:6px}
th{background:#020617}
.menu{display:grid;grid-template-columns:repeat(4,1fr);gap:6px}
h2,h3{text-align:center;color:#f87171}
.logo{width:80px;margin:8px auto;display:block}
#receipt{width:300px;background:#fff;color:#000;padding:16px;border-radius:12px}
</style>
</head>

<body>

<h2>âœŠ á€á€±á€¬á€ºá€œá€¾á€”á€ºá€›á€±á€¸ á€›á€”á€ºá€•á€¯á€¶á€„á€½á€± á€…á€®á€™á€¶á€á€”á€·á€ºá€á€½á€²á€™á€¾á€¯ âœŠ</h2>

<!-- LOGIN -->
<div id="login" class="card">
 <input id="email" placeholder="á€¡á€–á€½á€²á€·á€á€„á€º Email">
 <input id="password" type="password" placeholder="á€œá€»á€¾á€­á€¯á€·á€á€¾á€€á€º á€…á€€á€¬á€¸á€á€¾á€€á€º">
 <button onclick="login()">á€á€„á€ºá€›á€±á€¬á€€á€ºá€™á€Šá€º</button>
</div>

<!-- APP -->
<div id="app" class="hidden">

<div class="menu">
 <button onclick="show('add')">á€›á€”á€ºá€•á€¯á€¶á€„á€½á€± á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸</button>
 <button onclick="show('table')">á€á€±á€¬á€ºá€œá€¾á€”á€ºá€›á€±á€¸ á€…á€¬á€›á€„á€ºá€¸</button>
 <button onclick="show('report')">á€œá€…á€‰á€º á€¡á€…á€®á€›á€„á€ºá€á€¶á€…á€¬</button>
 <button onclick="logout()">á€‘á€½á€€á€ºá€™á€Šá€º</button>
</div>

<!-- ADD -->
<div id="add" class="card hidden">
 <h3>á€›á€”á€ºá€•á€¯á€¶á€„á€½á€± á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€á€¼á€„á€ºá€¸</h3>
 <input id="name" placeholder="á€¡á€œá€¾á€°á€›á€¾á€„á€º á€¡á€™á€Šá€º">
 <input id="place" placeholder="á€’á€±á€ / á€™á€¼á€­á€¯á€·á€”á€šá€º">
 <input id="amount" type="number" placeholder="á€‘á€±á€¬á€€á€ºá€•á€¶á€·á€„á€½á€±">
 <textarea id="note" placeholder="á€á€±á€¬á€ºá€œá€¾á€”á€ºá€›á€±á€¸ á€á€˜á€±á€¬á€‘á€¬á€¸ / á€™á€¾á€á€ºá€á€»á€€á€º"></textarea>
 <button onclick="save()">á€¡á€á€Šá€ºá€•á€¼á€¯ á€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€™á€Šá€º</button>
</div>

<!-- TABLE -->
<div id="table" class="card hidden">
 <h3>á€¡á€œá€¾á€°á€›á€¾á€„á€º á€…á€¬á€›á€„á€ºá€¸</h3>
 <table id="dataTable"></table>
 <h3>á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸ á€‘á€±á€¬á€€á€ºá€•á€¶á€·á€„á€½á€± : <span id="total">0</span> Ks</h3>
</div>

<!-- MONTHLY REPORT -->
<div id="report" class="card hidden">
 <h3>á€œá€…á€‰á€º á€á€±á€¬á€ºá€œá€¾á€”á€ºá€›á€±á€¸ á€¡á€…á€®á€›á€„á€ºá€á€¶á€…á€¬</h3>
 <select onchange="monthlyReport(this.value)" id="monthSelect"></select>
 <div id="reportResult"></div>
 <button class="alt" onclick="exportMonthlyPNG()">á€¡á€…á€®á€›á€„á€ºá€á€¶á€…á€¬ PNG á€‘á€¯á€á€ºá€™á€Šá€º</button>
</div>

</div>

<!-- RECEIPT -->
<div id="receipt" class="hidden">
 <img src="https://i.ibb.co/1000011246/logo.jpg" class="logo">
 <h3>á€á€±á€¬á€ºá€œá€¾á€”á€ºá€›á€±á€¸ á€›á€”á€ºá€•á€¯á€¶á€„á€½á€± á€œá€€á€ºá€á€¶á€•á€¼á€±á€…á€¬</h3>
 <hr>
 <p><b>á€¡á€œá€¾á€°á€›á€¾á€„á€º :</b> <span id="rName"></span></p>
 <p><b>á€’á€±á€ :</b> <span id="rPlace"></span></p>
 <p><b>á€‘á€±á€¬á€€á€ºá€•á€¶á€·á€„á€½á€± :</b> <span id="rAmount"></span> Ks</p>
 <p><b>á€™á€¾á€á€ºá€á€»á€€á€º :</b> <span id="rNote"></span></p>
 <p><b>á€”á€±á€·á€…á€½á€² :</b> <span id="rDate"></span></p>
</div>

<script>
// Firebase
const firebaseConfig={
 apiKey:"AIzaSyBojMFTkLXmaFGqwq9tLKpXp-wXKqkN_no",
 authDomain:"lamp-88a25.firebaseapp.com",
 databaseURL:"https://lamp-88a25-default-rtdb.asia-southeast1.firebasedatabase.app",
 projectId:"lamp-88a25",
 storageBucket:"lamp-88a25.appspot.com",
 messagingSenderId:"151980650338",
 appId:"1:151980650338:web:0e4e02c09d0ba58a16c63b"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.database();

let allData=[];
let months=new Set();

function login(){
 auth.signInWithEmailAndPassword(email.value,password.value)
 .then(()=>{login.classList.add("hidden");app.classList.remove("hidden");load();})
 .catch(e=>alert(e.message));
}
function logout(){auth.signOut();location.reload();}

function show(id){
 ["add","table","report"].forEach(x=>document.getElementById(x).classList.add("hidden"));
 document.getElementById(id).classList.remove("hidden");
}

function save(){
 const d={
  name:name.value,
  place:place.value,
  amount:Number(amount.value),
  note:note.value,
  date:new Date().toISOString()
 };
 db.ref("donations").push(d);
 name.value=place.value=amount.value=note.value="";
}

function load(){
 db.ref("donations").on("value",s=>{
  allData=[];
  months.clear();
  s.forEach(r=>{
   const v=r.val();
   allData.push(v);
   months.add(v.date.slice(0,7));
  });
  renderTable();
  renderMonths();
 });
}

function renderTable(){
 let t=0;
 let h="<tr><th>á€¡á€™á€Šá€º</th><th>á€’á€±á€</th><th>á€„á€½á€±</th><th>á€™á€¾á€á€ºá€á€»á€€á€º</th><th>Receipt</th></tr>";
 allData.forEach(d=>{
  t+=d.amount;
  h+=`
  <tr>
   <td>${d.name}</td>
   <td>${d.place}</td>
   <td>${d.amount}</td>
   <td>${d.note}</td>
   <td><button onclick='receipt(${JSON.stringify(d)})'>PNG</button></td>
  </tr>`;
 });
 dataTable.innerHTML=h;
 total.innerText=t;
}

function renderMonths(){
 monthSelect.innerHTML="";
 [...months].sort().forEach(m=>{
  monthSelect.innerHTML+=`<option value="${m}">${m}</option>`;
 });
}

function monthlyReport(m){
 let sum=0;
 let count=0;
 allData.filter(d=>d.date.startsWith(m)).forEach(d=>{
  sum+=d.amount;count++;
 });
 reportResult.innerHTML=`
 <p>ğŸ“… á€œ : <b>${m}</b></p>
 <p>âœŠ á€‘á€±á€¬á€€á€ºá€•á€¶á€·á€á€° á€¡á€›á€±á€¡á€á€½á€€á€º : <b>${count}</b></p>
 <p>ğŸ”¥ á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸ á€‘á€±á€¬á€€á€ºá€•á€¶á€·á€„á€½á€± : <b>${sum}</b> Ks</p>`;
}

function exportMonthlyPNG(){
 html2canvas(document.getElementById("report")).then(c=>{
  const a=document.createElement("a");
  a.href=c.toDataURL();
  a.download="monthly_report.png";
  a.click();
 });
}

function receipt(d){
 rName.innerText=d.name;
 rPlace.innerText=d.place;
 rAmount.innerText=d.amount;
 rNote.innerText=d.note;
 rDate.innerText=new Date(d.date).toLocaleString();
 receiptDiv.classList.remove("hidden");
 html2canvas(receiptDiv).then(c=>{
  const a=document.createElement("a");
  a.href=c.toDataURL();
  a.download="receipt.png";
  a.click();
  receiptDiv.classList.add("hidden");
 });
}
const receiptDiv=document.getElementById("receipt");
</script>

</body>
</html>