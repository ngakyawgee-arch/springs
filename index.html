<!DOCTYPE html>
<html lang="my">
<head>
<meta charset="UTF-8">
<title>á€–á€­á€¯á€¸á€…á€±á€¬á€„á€·á€ºá€á€±á€¬á€„á€ºá€™á€®á€¸á€¡á€­á€™á€º (LFM)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- Export -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{margin:0;background:#0d0d0d;color:#fff;font-family:sans-serif}
.container{max-width:420px;margin:auto;padding:15px}
.card{background:#1a1a1a;padding:15px;border-radius:14px;margin-bottom:12px}
h2,h3{text-align:center;margin:6px 0}
input,button{width:100%;padding:12px;margin:6px 0;border-radius:10px;border:none}
button{background:#1e8f4d;color:#fff;font-weight:bold}
.gray{background:#333}
.red{background:#b71c1c}
.hide{display:none}
table{width:100%;border-collapse:collapse}
th,td{border-bottom:1px solid #333;padding:6px;text-align:center;font-size:13px}
footer{text-align:center;opacity:.6;margin-top:20px}
.small{font-size:12px;opacity:.8}
.actionBtn{padding:4px 8px;font-size:12px}
</style>
</head>

<body>
<div class="container">

<h2>âœŠ á€–á€­á€¯á€¸á€…á€±á€¬á€„á€·á€ºá€á€±á€¬á€„á€ºá€™á€®á€¸á€¡á€­á€™á€º (LFM)</h2>
<p class="small" align="center">á€á€±á€¬á€ºá€œá€¾á€”á€ºá€›á€±á€¸á€€á€­á€¯ á€¡á€¬á€¸á€•á€±á€¸á€á€±á€¬ á€¡á€œá€¾á€°á€›á€¾á€„á€ºá€™á€»á€¬á€¸á á€™á€¾á€á€ºá€á€™á€ºá€¸</p>

<!-- LOGIN -->
<div id="loginBox" class="card">
  <h3>Admin Login</h3>
  <input id="email" placeholder="Admin Email">
  <input id="password" type="password" placeholder="Admin Password">
  <button onclick="adminLogin()">Admin á€á€„á€ºá€™á€Šá€º</button>
  <hr>
  <h3>Member Login</h3>
  <input id="memberPin" placeholder="Member PIN">
  <button class="gray" onclick="memberLogin()">Member á€á€„á€ºá€™á€Šá€º</button>
</div>

<!-- MAIN -->
<div id="mainBox" class="hide">

<div class="card">
  <button onclick="showAdd()">â• á€¡á€œá€¾á€°á€‘á€Šá€·á€º</button>
  <button onclick="showTable()">ğŸ“‹ á€…á€¬á€›á€„á€ºá€¸á€€á€¼á€Šá€·á€º</button>
  <button onclick="exportPNG()">ğŸ–¼ PNG</button>
  <button onclick="exportPDF()">ğŸ“„ PDF</button>
  <button class="red" onclick="logout()">Logout</button>
</div>

<!-- ADD -->
<div id="addBox" class="card hide">
  <h3 id="formTitle">á€¡á€œá€¾á€°á€…á€¬á€›á€„á€ºá€¸á€‘á€Šá€·á€º</h3>
  <input id="name" placeholder="á€¡á€™á€Šá€º">
  <input id="place" placeholder="á€”á€±á€›á€•á€º / á€”á€­á€¯á€„á€ºá€„á€¶">
  <input id="amount" type="number" placeholder="á€¡á€œá€¾á€°á€„á€½á€±">
  <input id="note" placeholder="á€™á€¾á€á€ºá€á€»á€€á€º">
  <button onclick="saveData()">á€á€­á€™á€ºá€¸á€™á€Šá€º</button>
</div>

<!-- TABLE -->
<div id="tableBox" class="card hide">
  <h3>á€¡á€œá€¾á€°á€›á€¾á€„á€ºá€…á€¬á€›á€„á€ºá€¸</h3>
  <table>
    <thead>
      <tr>
        <th>á€¡á€™á€Šá€º</th>
        <th>á€”á€±á€›á€•á€º</th>
        <th>á€„á€½á€±</th>
        <th>á€™á€¾á€á€ºá€á€»á€€á€º</th>
        <th id="actionCol">á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€á€»á€€á€º</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>
  <div id="summary" class="small"></div>
</div>

</div>

<footer>âœŠ Revolution Powered by LFM</footer>
</div>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyBojMFTkLXmaFGqwq9tLKpXp-wXKqkN_no",
  authDomain: "lamp-88a25.firebaseapp.com",
  databaseURL: "https://lamp-88a25-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "lamp-88a25"
});
const auth=firebase.auth();
const db=firebase.database();

/* STATE */
let role="", editId=null;

/* LOGIN */
function adminLogin(){
  if(!email.value||!password.value) return alert("á€–á€¼á€Šá€·á€ºá€•á€«");
  auth.signInWithEmailAndPassword(email.value,password.value)
  .then(()=>{ role="admin"; enter(); })
  .catch(e=>alert(e.message));
}
function memberLogin(){
  if(memberPin.value==="1111"){ role="member"; enter(); }
  else alert("PIN á€™á€¾á€¬á€¸");
}
function enter(){
  loginBox.classList.add("hide");
  mainBox.classList.remove("hide");
  if(role==="member") actionCol.style.display="none";
  loadData();
}
function logout(){ location.reload(); }

/* VIEW */
function hideAll(){ addBox.classList.add("hide"); tableBox.classList.add("hide"); }
function showAdd(){
  if(role!=="admin") return alert("Admin only");
  editId=null;
  formTitle.innerText="á€¡á€œá€¾á€°á€…á€¬á€›á€„á€ºá€¸á€‘á€Šá€·á€º";
  name.value=place.value=amount.value=note.value="";
  hideAll(); addBox.classList.remove("hide");
}
function showTable(){ hideAll(); tableBox.classList.remove("hide"); }

/* SAVE */
function saveData(){
  if(role!=="admin") return alert("Admin only");
  if(!name.value||!place.value||!amount.value) return alert("á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€¡á€•á€¼á€Šá€·á€ºá€‘á€Šá€·á€ºá€•á€«");
  const data={name:name.value,place:place.value,amount:+amount.value,note:note.value,time:Date.now()};
  const ref = editId?db.ref("donations/"+editId):db.ref("donations").push();
  ref.set(data).then(()=>{ alert("á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€•á€«á€•á€¼á€®"); showTable(); });
}

/* LOAD */
function loadData(){
  db.ref("donations").on("value",snap=>{
    tbody.innerHTML=""; let total=0;
    snap.forEach(c=>{
      const d=c.val(); total+=d.amount;
      tbody.innerHTML+=`
      <tr>
        <td>${d.name}</td>
        <td>${d.place}</td>
        <td>${d.amount}</td>
        <td>${d.note||""}</td>
        <td>${role==="admin"?`
          <button class="actionBtn" onclick="edit('${c.key}')">âœï¸</button>
          <button class="actionBtn red" onclick="del('${c.key}')">âŒ</button>`:""}
        </td>
      </tr>`;
    });
    summary.innerText="á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸ á€¡á€œá€¾á€°á€„á€½á€± = "+total;
  });
}

/* EDIT / DELETE */
function edit(id){
  db.ref("donations/"+id).once("value",s=>{
    const d=s.val(); editId=id;
    formTitle.innerText="á€¡á€œá€¾á€°á€…á€¬á€›á€„á€ºá€¸á€•á€¼á€„á€º";
    name.value=d.name; place.value=d.place; amount.value=d.amount; note.value=d.note||"";
    showAdd();
  });
}
function del(id){ if(confirm("á€–á€»á€€á€ºá€™á€œá€¬á€¸")) db.ref("donations/"+id).remove(); }

/* EXPORT */
function exportPNG(){ showTable(); html2canvas(tableBox).then(c=>{const a=document.createElement("a");a.download="LFM.png";a.href=c.toDataURL();a.click();});}
function exportPDF(){ showTable(); html2canvas(tableBox).then(c=>{const {jsPDF}=window.jspdf;const pdf=new jsPDF();pdf.addImage(c.toDataURL(),"PNG",10,10,190,0);pdf.save("LFM_Report.pdf");});}
</script>
</body>
</html>